"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.withThemeByDataAttribute = void 0;

var _addons = require("@storybook/addons");

var _helpers = require("./helpers");

var DEFAULT_ELEMENT_SELECTOR = "html";
var DEFAULT_DATA_ATTRIBUTE = "data-theme";

var withThemeByDataAttribute = function withThemeByDataAttribute(_ref) {
  var themes = _ref.themes,
      defaultTheme = _ref.defaultTheme,
      _ref$parentSelector = _ref.parentSelector,
      parentSelector = _ref$parentSelector === void 0 ? DEFAULT_ELEMENT_SELECTOR : _ref$parentSelector,
      _ref$attributeName = _ref.attributeName,
      attributeName = _ref$attributeName === void 0 ? DEFAULT_DATA_ATTRIBUTE : _ref$attributeName;
  (0, _helpers.initializeThemeState)(Object.keys(themes), defaultTheme);
  return function (storyFn, context) {
    var _useThemeParameters = (0, _helpers.useThemeParameters)(),
        themeOverride = _useThemeParameters.themeOverride;

    var selected = (0, _helpers.pluckThemeFromContext)(context);
    (0, _addons.useEffect)(function () {
      var parentElement = document.querySelector(parentSelector);
      var themeKey = themeOverride || selected || defaultTheme;
      parentElement.setAttribute(attributeName, themes[themeKey]);
    }, [themeOverride, selected, parentSelector, attributeName]);
    return storyFn();
  };
};

exports.withThemeByDataAttribute = withThemeByDataAttribute;