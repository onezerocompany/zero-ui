import { useEffect } from "@storybook/addons";
import { initializeThemeState, pluckThemeFromContext, useThemeParameters } from "./helpers";
var DEFAULT_ELEMENT_SELECTOR = "html";
var DEFAULT_DATA_ATTRIBUTE = "data-theme";
export var withThemeByDataAttribute = function withThemeByDataAttribute(_ref) {
  var themes = _ref.themes,
      defaultTheme = _ref.defaultTheme,
      _ref$parentSelector = _ref.parentSelector,
      parentSelector = _ref$parentSelector === void 0 ? DEFAULT_ELEMENT_SELECTOR : _ref$parentSelector,
      _ref$attributeName = _ref.attributeName,
      attributeName = _ref$attributeName === void 0 ? DEFAULT_DATA_ATTRIBUTE : _ref$attributeName;
  initializeThemeState(Object.keys(themes), defaultTheme);
  return function (storyFn, context) {
    var _useThemeParameters = useThemeParameters(),
        themeOverride = _useThemeParameters.themeOverride;

    var selected = pluckThemeFromContext(context);
    useEffect(function () {
      var parentElement = document.querySelector(parentSelector);
      var themeKey = themeOverride || selected || defaultTheme;
      parentElement.setAttribute(attributeName, themes[themeKey]);
    }, [themeOverride, selected, parentSelector, attributeName]);
    return storyFn();
  };
};